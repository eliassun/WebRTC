function createAudioMeter(a,b,c,d){var e=a.createScriptProcessor(512);return e.onaudioprocess=volumeAudioProcess,e.clipping=!1,e.lastClip=0,e.volume=0,e.clipLevel=b||.98,e.averaging=c||.95,e.clipLag=d||750,e.connect(a.destination),e.checkClipping=function(){return!!this.clipping&&(this.lastClip+this.clipLag<window.performance.now()&&(this.clipping=!1),this.clipping)},e.shutdown=function(){this.disconnect(),this.onaudioprocess=null},e}function volumeAudioProcess(a){for(var b,c=a.inputBuffer.getChannelData(0),d=c.length,e=0,f=0;f<d;f++)b=c[f],Math.abs(b)>=this.clipLevel&&(this.clipping=!0,this.lastClip=window.performance.now()),e+=b*b;var g=Math.sqrt(e/d);this.volume=Math.max(g,this.volume*this.averaging)}!function(){function a(a,b){var c={audio:!1,video:{mandatory:{chromeMediaSource:a?"screen":"desktop",maxWidth:window.screen.width>1920?window.screen.width:1920,maxHeight:window.screen.height>1080?window.screen.height:1080},optional:[]}};return b&&(c.video.mandatory.chromeMediaSourceId=b),c}function b(){return d?d.isLoaded?void d.contentWindow.postMessage({captureSourceId:!0},"*"):void setTimeout(b,100):void c(b)}function c(a){if(d)return void a();d=document.createElement("iframe"),d.onload=function(){d.isLoaded=!0,a()},d.src="https://www.webrtc-experiment.com/getSourceId/",d.style.display="none",(document.body||document.documentElement).appendChild(d)}window.getScreenId=function(c){function d(b){b.data&&(b.data.chromeMediaSourceId&&("PermissionDeniedError"===b.data.chromeMediaSourceId?c("permission-denied"):c(null,b.data.chromeMediaSourceId,a(null,b.data.chromeMediaSourceId))),b.data.chromeExtensionStatus&&c(b.data.chromeExtensionStatus,null,a(b.data.chromeExtensionStatus)),window.removeEventListener("message",d))}if(navigator.mozGetUserMedia)return void c(null,"firefox",{video:{mozMediaSource:"window",mediaSource:"window"}});b(),window.addEventListener("message",d)};var d;window.getScreenConstraints=function(a){c(function(){getScreenId(function(b,c,d){a(b,d.video)})})}}(),function(){function a(a,b){var c={audio:!1,video:{mandatory:{chromeMediaSource:a?"screen":"desktop",maxWidth:window.screen.width>1920?window.screen.width:1920,maxHeight:window.screen.height>1080?window.screen.height:1080},optional:[]}};return b&&(c.video.mandatory.chromeMediaSourceId=b),c}function b(){return d?d.isLoaded?void d.contentWindow.postMessage({captureSourceId:!0},"*"):void setTimeout(b,100):void c(b)}function c(a){if(d)return void a();d=document.createElement("iframe"),d.onload=function(){d.isLoaded=!0,a()},d.src="https://www.webrtc-experiment.com/getSourceId/",d.style.display="none",(document.body||document.documentElement).appendChild(d)}if(-1!==document.domain.indexOf("webrtc-experiment.com")){window.getScreenId=function(c){function d(b){b.data&&(b.data.chromeMediaSourceId&&("PermissionDeniedError"===b.data.chromeMediaSourceId?c("permission-denied"):c(null,b.data.chromeMediaSourceId,a(null,b.data.chromeMediaSourceId))),b.data.chromeExtensionStatus&&c(b.data.chromeExtensionStatus,null,a(b.data.chromeExtensionStatus)),window.removeEventListener("message",d))}if(navigator.mozGetUserMedia)return void c(null,"firefox",{video:{mozMediaSource:"window",mediaSource:"window"}});b(),window.addEventListener("message",d)};var d;window.getScreenConstraints=function(a){c(function(){getScreenId(function(b,c,d){a(b,d.video)})})}}}(),function(a){"use strict";function b(a,b){var c=(65535&a)+(65535&b);return(a>>16)+(b>>16)+(c>>16)<<16|65535&c}function c(a,b){return a<<b|a>>>32-b}function d(a,d,e,f,g,h){return b(c(b(b(d,a),b(f,h)),g),e)}function e(a,b,c,e,f,g,h){return d(b&c|~b&e,a,b,f,g,h)}function f(a,b,c,e,f,g,h){return d(b&e|c&~e,a,b,f,g,h)}function g(a,b,c,e,f,g,h){return d(b^c^e,a,b,f,g,h)}function h(a,b,c,e,f,g,h){return d(c^(b|~e),a,b,f,g,h)}function i(a,c){a[c>>5]|=128<<c%32,a[14+(c+64>>>9<<4)]=c;var d,i,j,k,l,m=1732584193,n=-271733879,o=-1732584194,p=271733878;for(d=0;d<a.length;d+=16)i=m,j=n,k=o,l=p,m=e(m,n,o,p,a[d],7,-680876936),p=e(p,m,n,o,a[d+1],12,-389564586),o=e(o,p,m,n,a[d+2],17,606105819),n=e(n,o,p,m,a[d+3],22,-1044525330),m=e(m,n,o,p,a[d+4],7,-176418897),p=e(p,m,n,o,a[d+5],12,1200080426),o=e(o,p,m,n,a[d+6],17,-1473231341),n=e(n,o,p,m,a[d+7],22,-45705983),m=e(m,n,o,p,a[d+8],7,1770035416),p=e(p,m,n,o,a[d+9],12,-1958414417),o=e(o,p,m,n,a[d+10],17,-42063),n=e(n,o,p,m,a[d+11],22,-1990404162),m=e(m,n,o,p,a[d+12],7,1804603682),p=e(p,m,n,o,a[d+13],12,-40341101),o=e(o,p,m,n,a[d+14],17,-1502002290),n=e(n,o,p,m,a[d+15],22,1236535329),m=f(m,n,o,p,a[d+1],5,-165796510),p=f(p,m,n,o,a[d+6],9,-1069501632),o=f(o,p,m,n,a[d+11],14,643717713),n=f(n,o,p,m,a[d],20,-373897302),m=f(m,n,o,p,a[d+5],5,-701558691),p=f(p,m,n,o,a[d+10],9,38016083),o=f(o,p,m,n,a[d+15],14,-660478335),n=f(n,o,p,m,a[d+4],20,-405537848),m=f(m,n,o,p,a[d+9],5,568446438),p=f(p,m,n,o,a[d+14],9,-1019803690),o=f(o,p,m,n,a[d+3],14,-187363961),n=f(n,o,p,m,a[d+8],20,1163531501),m=f(m,n,o,p,a[d+13],5,-1444681467),p=f(p,m,n,o,a[d+2],9,-51403784),o=f(o,p,m,n,a[d+7],14,1735328473),n=f(n,o,p,m,a[d+12],20,-1926607734),m=g(m,n,o,p,a[d+5],4,-378558),p=g(p,m,n,o,a[d+8],11,-2022574463),o=g(o,p,m,n,a[d+11],16,1839030562),n=g(n,o,p,m,a[d+14],23,-35309556),m=g(m,n,o,p,a[d+1],4,-1530992060),p=g(p,m,n,o,a[d+4],11,1272893353),o=g(o,p,m,n,a[d+7],16,-155497632),n=g(n,o,p,m,a[d+10],23,-1094730640),m=g(m,n,o,p,a[d+13],4,681279174),p=g(p,m,n,o,a[d],11,-358537222),o=g(o,p,m,n,a[d+3],16,-722521979),n=g(n,o,p,m,a[d+6],23,76029189),m=g(m,n,o,p,a[d+9],4,-640364487),p=g(p,m,n,o,a[d+12],11,-421815835),o=g(o,p,m,n,a[d+15],16,530742520),n=g(n,o,p,m,a[d+2],23,-995338651),m=h(m,n,o,p,a[d],6,-198630844),p=h(p,m,n,o,a[d+7],10,1126891415),o=h(o,p,m,n,a[d+14],15,-1416354905),n=h(n,o,p,m,a[d+5],21,-57434055),m=h(m,n,o,p,a[d+12],6,1700485571),p=h(p,m,n,o,a[d+3],10,-1894986606),o=h(o,p,m,n,a[d+10],15,-1051523),n=h(n,o,p,m,a[d+1],21,-2054922799),m=h(m,n,o,p,a[d+8],6,1873313359),p=h(p,m,n,o,a[d+15],10,-30611744),o=h(o,p,m,n,a[d+6],15,-1560198380),n=h(n,o,p,m,a[d+13],21,1309151649),m=h(m,n,o,p,a[d+4],6,-145523070),p=h(p,m,n,o,a[d+11],10,-1120210379),o=h(o,p,m,n,a[d+2],15,718787259),n=h(n,o,p,m,a[d+9],21,-343485551),m=b(m,i),n=b(n,j),o=b(o,k),p=b(p,l);return[m,n,o,p]}function j(a){var b,c="";for(b=0;b<32*a.length;b+=8)c+=String.fromCharCode(a[b>>5]>>>b%32&255);return c}function k(a){var b,c=[];for(c[(a.length>>2)-1]=void 0,b=0;b<c.length;b+=1)c[b]=0;for(b=0;b<8*a.length;b+=8)c[b>>5]|=(255&a.charCodeAt(b/8))<<b%32;return c}function l(a){return j(i(k(a),8*a.length))}function m(a,b){var c,d,e=k(a),f=[],g=[];for(f[15]=g[15]=void 0,e.length>16&&(e=i(e,8*a.length)),c=0;16>c;c+=1)f[c]=909522486^e[c],g[c]=1549556828^e[c];return d=i(f.concat(k(b)),512+8*b.length),j(i(g.concat(d),640))}function n(a){var b,c,d="0123456789abcdef",e="";for(c=0;c<a.length;c+=1)b=a.charCodeAt(c),e+=d.charAt(b>>>4&15)+d.charAt(15&b);return e}function o(a){return unescape(encodeURIComponent(a))}function p(a){return l(o(a))}function q(a){return n(p(a))}function r(a,b){return m(o(a),o(b))}function s(a,b){return n(r(a,b))}function t(a,b,c){return b?c?r(b,a):s(b,a):c?p(a):q(a)}"function"==typeof define&&define.amd?define(function(){return t}):a.md5=t}(this),function(){"use strict";var a=angular.module("vertoApp",["timer","ngRoute","vertoControllers","vertoDirectives","vertoFilters","ngStorage","ngAnimate","ngSanitize","toastr","FBAngular","cgPrompt","720kb.tooltips","ui.gravatar","ui.bootstrap","directive.g+signin","pascalprecht.translate","angular-click-outside"]);a.constant("configLanguages",{languages:[{id:"en",name:"English"},{id:"it",name:"Italiano"},{id:"fr",name:"Français"},{id:"de",name:"Deutsch"},{id:"pt",name:"Português"},{id:"pl",name:"Polski"},{id:"zh",name:"中國"},{id:"ru",name:"Pусский"},{id:"sv",name:"Svenska"},{id:"da",name:"Dansk"},{id:"es",name:"Español"},{id:"id",name:"Indonesia"}],dialects:{en:"en",en_GB:"en",en_US:"en",it:"it",it_IT:"it",fr:"fr",fr_FR:"fr",fr_CA:"fr",pt:"pt",pt_BR:"pt",pt_PT:"pt",de:"de",de_DE:"de",es:"es",es_ES:"es",pl:"pl",pl_PL:"pl",ru:"ru",ru_RU:"ru",sv:"sv",sv_SV:"sv",sv_FI:"sv",da:"da",da_DK:"da",id:"id",id_ID:"id",zh:"zh",zh_CN:"zh",zh_TW:"zh",zh_HK:"zh"}}),a.config(["$routeProvider","gravatarServiceProvider","$translateProvider","configLanguages",function(a,b,c,d){a.when("/",{title:"Loading",templateUrl:"partials/splash_screen.html",controller:"SplashScreenController"}).when("/login",{title:"Login",templateUrl:"partials/login.html",controller:"LoginController"}).when("/dialpad",{title:"Dialpad",templateUrl:"partials/dialpad.html",controller:"DialPadController"}).when("/incall",{title:"In a Call",templateUrl:"partials/incall.html",controller:"InCallController"}).when("/loading",{title:"Loading Verto Communicator",templateUrl:"partials/loading.html",controller:"LoadingController"}).when("/preview",{title:"Preview Video",templateUrl:"partials/preview.html",controller:"PreviewController"}).when("/browser-upgrade",{title:"",templateUrl:"partials/browser_upgrade.html",controller:"BrowserUpgradeController"}).otherwise({redirectTo:"/"}),b.defaults={default:"mm"};var e=[];angular.forEach(d.languages,function(a,b){e.push(a.id)}),c.useStaticFilesLoader({prefix:"locales/locale-",suffix:".json"}).registerAvailableLanguageKeys(e,d.dialects).preferredLanguage("en").determinePreferredLanguage().fallbackLanguage("en").useSanitizeValueStrategy(null)}]),a.run(["$rootScope","$location","toastr","prompt","verto",function(a,b,c,d,e){a.$on("$routeChangeStart",function(a,c,d){e.data.connected||"partials/login.html"===c.templateUrl||b.path("/")}),a.$on("$routeChangeSuccess",function(b,c,d){a.title=c.$$route.title}),a.safeProtocol=!1,"https:"==window.location.protocol&&(a.safeProtocol=!0),a.promptInput=function(a,b,c,e){d({title:a,message:b,input:!0,label:c}).then(function(a){angular.isFunction(e)&&e(a)},function(){})}}])}(),function(){"use strict";angular.module("vertoControllers",["ui.bootstrap","vertoService","storageService","ui.gravatar"])}(),function(){"use strict";angular.module("vertoControllers").controller("SplashScreenController",["$scope","$rootScope","$location","$timeout","storage","splashscreen","prompt","verto",function(a,b,c,d,e,f,g,h){console.debug("Executing SplashScreenController."),a.progress_percentage=f.progress_percentage,a.message="",a.interrupt_next=!1,a.errors=[];var i=function(a,b){b&&"browser-upgrade"==b&&(a=b),c.path(a)},j=function(b,c,d,e,g,h,j){if(a.progress_percentage=f.calculate(b),a.message=j,h&&"error"==c){if(a.errors.push(j),!g)return void i("",e);j+=". Continue?",confirm(j)||(a.interrupt_next=!0)}if(!a.interrupt_next)return a.message=f.getProgressMessage(b+1),!0};b.$on("progress.next",function(a,b,c,e,g,h,i,k){d(function(){if(e)return void e.then(function(a){k=a.message,c=a.status,j(b,c,e,g,h,i,k)&&f.next()});j(b,c,e,g,h,i,k)&&f.next()},400)}),b.$on("progress.complete",function(b,d){a.message="Complete",h.data.connected?c.path("/dialpad"):(i("/login"),c.path("/login"))}),f.next()}])}(),function(){"use strict";angular.module("vertoControllers").controller("BrowserUpgradeController",["$scope","$http","$location","verto","storage","Fullscreen",function(a,b,c,d,e,f){console.debug("Executing BrowserUpgradeController.")}])}(),function(){"use strict";angular.module("vertoControllers").controller("ChatController",["$scope","$rootScope","$http","$location","$anchorScroll","$timeout","verto","prompt","$translate",function(a,b,c,d,e,f,g,h,i){function j(){var a=document.querySelector(".chat-messages");a.scrollTop=a.scrollHeight}function k(){a.members=[],a.messages=[],a.message=r}function l(a){for(var b=g.data.confLayoutsData,c=0;c<b.length;c++)if(b[c].name===a)return b[c].resIDS}function m(b){a.members.forEach(function(c){var d=c.status.video.reservationID;console.debug("resID to clear: "+d),d&&b&&-1!==b.indexOf(d)||d&&(console.debug("clearing resid ["+d+"] from ["+c.id+"]"),a.confResID(c.id,d))})}function n(b){var c=!1;for(var d in a.members){if(a.members[d].uuid==b){c=!0;break}}return c?d:-1}function o(a){return{uuid:a[0],id:a[1][0],number:a[1][1],name:a[1][2],codec:a[1][3],status:JSON.parse(a[1][4]),email:a[1][5].email}}function p(b){a.members.push(o(b))}function q(a,b){h({title:a,input:!0,label:"",value:""}).then(function(a){a&&b&&b(a)})}console.debug("Executing ChatController.");var r="";k(),a.$watch("activePane",function(){"chat"==a.activePane&&(b.chat_counter=0),b.activePane=a.activePane}),b.$on("chat.newMessage",function(c,d){d.created_at=new Date,console.log("chat.newMessage",d),a.$apply(function(){a.messages.push(d),d.from==g.data.name||a.chatStatus||"chat"==a.activePane||++b.chat_counter,f(function(){j()},300)})}),b.$on("call.conference",function(b,c){f(function(){a.conf=g.data.conf.params.laData})}),b.$on("changedVideoLayout",function(b,c){a.resIDs=l(c),m(a.resIDs)}),b.$on("conference.canvasInfo",function(b,c){a.currentLayout=c[0].layoutName,a.resIDs=l(a.currentLayout)}),b.$on("hangupCall",function(){a.openId=null}),b.$on("members.boot",function(b,c){a.$apply(function(){k();for(var a in c){p(c[a])}})}),b.$on("members.add",function(b,c){a.$apply(function(){p(c)})}),b.$on("members.del",function(c,d){b.watcher&&b.master===d&&(g.hangup(),window.close()),a.$apply(function(){var b=n(d);-1!=b&&a.members.splice(b,1)})}),b.$on("members.update",function(b,c){c=o(c);var d=n(c.uuid);d<0?console.log("Didn't find the member uuid "+c.uuid):a.$apply(function(){parseInt(c.id)==parseInt(g.data.conferenceMemberID)&&(g.data.mutedMic=c.status.audio.muted,g.data.mutedVideo=c.status.video.muted,g.data.call.setMute(c.status.audio.muted?"off":"on"),g.data.call.setVideoMute(c.status.video.muted?"off":"on")),angular.extend(a.members[d],c)})}),b.$on("members.clear",function(b){a.$applyAsync(function(){k(),a.closeChat()})}),a.toggleModMenu=function(b){"moderator"==g.data.confRole&&(a.openId=a.openId==b?null:b)},a.send=function(b){b&&"keydown"==b.type&&b.preventDefault(),g.sendConferenceChat(a.message),a.message=r},a.confKick=function(a){console.log("$scope.confKick"),g.data.conf.kick(a)},a.confMuteMic=function(a){"moderator"==g.data.confRole&&(console.log("$scope.confMuteMic"),g.data.conf.muteMic(a))},a.confMuteVideo=function(a){"moderator"==g.data.confRole&&(console.log("$scope.confMuteVideo"),g.data.conf.muteVideo(a))},a.confPresenter=function(a){console.log("$scope.confPresenter"),g.data.conf.presenter(a)},a.confResID=function(a,b){console.log("Set",a,"to",b),g.setResevartionId(a,b)},a.confVideoFloor=function(a){console.log("$scope.confVideoFloor"),g.data.conf.videoFloor(a)},a.confBanner=function(a){console.log("$scope.confBanner"),h({title:i.instant("TITLE_INSERT_BANNER"),input:!0,label:"",value:""}).then(function(b){b&&g.data.conf.banner(a,b)})},a.confCanvasIn=function(a,b){if(b)return void g.setCanvasIn(a,b);q(i.instant("TITLE_INSERT_CANVAS_ID"),function(b){console.log(a,b),g.setCanvasIn(a,b)})},a.confCanvasOut=function(a,b){if(b)return void g.setCanvasOut(a,b);q(i.instant("TITLE_INSERT_CANVAS_ID"),function(b){g.setCanvasOut(a,b)})},a.confLayer=function(a,b){if(b)return void g.setLayer(a,b);q(i.instant("TITLE_INSERT_LAYER"),function(b){g.setLayer(a,b)})},a.confResetBanner=function(a){console.log("$scope.confResetBanner"),g.data.conf.banner(a,"reset")},a.confVolumeDown=function(a){console.log("$scope.confVolumeDown"),g.data.conf.volumeDown(a)},a.confVolumeUp=function(a){console.log("$scope.confVolumeUp"),g.data.conf.volumeUp(a)},a.confGainDown=function(a){console.log("$scope.confGainDown"),g.data.conf.gainDown(a)},a.confGainUp=function(a){console.log("$scope.confGainUp"),g.data.conf.gainUp(a)},a.confTransfer=function(a){console.log("$scope.confTransfer"),b.disableOnKeydownDtmf(),h({title:i.instant("TITLE_TRANSFER"),message:i.instant("MESSAGE_TRANSFER"),input:!0,label:i.instant("LABEL_TRANSFER"),value:""}).then(function(c){b.enableOnKeydownDtmf(),c&&g.data.conf.transfer(a,c)}).catch(function(){b.enableOnKeydownDtmf()})},a.confToggleDeaf=function(a){"moderator"==g.data.confRole&&(console.log("$scope.confToggleDeaf"),a.status.audio.deaf?g.data.conf.undeaf(a.id):g.data.conf.deaf(a.id))}}])}(),function(){"use strict";angular.module("vertoControllers").controller("ContributorsController",["$scope","$http","toastr",function(a,b,c){var d=window.location.origin+window.location.pathname;b.get(d+"contributors.txt").success(function(b){var c=[];angular.forEach(b,function(a,b){var c=/(.*) <(.*)>/,d=a.replace(c,"$1"),e=a.replace(c,"$2");this.push({name:d,email:e})},c),a.contributors=c}).error(function(){c.error("contributors not found.")})}])}(),function(){"use strict";angular.module("vertoControllers").controller("AboutController",["$scope","$http","toastr",function(a,b,c){a.githash="3510866140"}])}(),function(){"use strict";angular.module("vertoControllers").controller("DialPadController",["$rootScope","$scope","$http","$location","toastr","verto","storage","CallHistory","eventQueue","$timeout",function(a,b,c,d,e,f,g,h,i,j){function k(b){return g.data.onHold=!1,g.data.cur_call=0,a.dialpadNumber=b,!a.dialpadNumber&&g.data.called_number?(a.dialpadNumber=g.data.called_number,!1):a.dialpadNumber||g.data.called_number?f.data.call?(console.debug("A call is already in progress."),!1):-1!=b.indexOf("-canvas-")?(a.watcher=!0,f.call(a.dialpadNumber,null,{useCamera:"none",useMic:"none",useSpeak:"none",caller_id_name:null,userVariables:{},caller_id_number:null,mirrorInput:!1}),void d.path("/incall")):(g.data.mutedVideo=!1,g.data.mutedMic=!1,g.data.videoCall=!1,f.call(a.dialpadNumber),g.data.called_number=a.dialpadNumber,h.add(a.dialpadNumber,"outbound"),void d.path("/incall")):(e.warning("Enter an extension, please."),!1)}console.debug("Executing DialPadController."),i.process(),d.search().autocall&&(a.dialpadNumber=d.search().autocall,delete d.search().autocall,k(a.dialpadNumber),a.watcher)||(b.call_history=h.all(),b.history_control=h.all_control(),b.has_history=Object.keys(b.call_history).length,g.data.videoCall=!1,g.data.userStatus="connecting",g.data.calling=!1,b.clearCallHistory=function(){return h.clear(),b.call_history=h.all(),b.history_control=h.all_control(),b.has_history=Object.keys(b.call_history).length,b.history_control},b.viewCallsList=function(a){return b.call_list=a},"autocall"in f.data&&(a.dialpadNumber=f.data.autocall,delete f.data.autocall,k(a.dialpadNumber)),b.fillDialpadNumber=function(b){a.dialpadNumber=b},b.preview=function(){d.path("/preview")},a.transfer=function(){if(!a.dialpadNumber)return!1;f.data.call.transfer(a.dialpadNumber)},b.loading=!1,b.cancelled=!1,a.call=function(c){if(!g.data.testSpeedJoin||!a.dialpadNumber)return k(c);b.loading=!0,f.testSpeed(function(){if(b.cancelled)return b.cancelled=!1,void(b.loading=!1);k(c)})},a.cancel=function(){b.cancelled=!0})}])}(),function(){"use strict";angular.module("vertoControllers").controller("InCallController",["$rootScope","$scope","$http","$location","$modal","$timeout","toastr","verto","storage","prompt","Fullscreen","$translate",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(){b.conf=h.data.conf.params.laData,b.canvases=[{id:1,name:"Super Canvas"}];for(var a=1;a<b.conf.canvasCount;a++)b.canvases.push({id:a+1,name:"Canvas "+(a+1)})}console.debug("Executing InCallController."),b.layout=null,a.dialpadNumber="",b.callTemplate="partials/phone_call.html",b.dialpadTemplate="",b.incall=!0,i.data.videoCall&&(b.callTemplate="partials/video_call.html"),a.$on("call.conference",function(a,c){f(function(){b.chatStatus&&b.openChat(),m()})}),a.$on("call.video",function(a,c){f(function(){b.callTemplate="partials/video_call.html"})}),b.toggleDialpad=function(){b.openModal("partials/dialpad_widget.html","ModalDialpadController")},b.videoCall=function(){j({title:l.instant("TITLE_ENABLE_VIDEO"),message:l.instant("MESSAGE_ENABLE_VIDEO")}).then(function(){i.data.videoCall=!0,b.callTemplate="partials/video_call.html"})},b.cbMuteVideo=function(a,b){i.data.mutedVideo=!i.data.mutedVideo},b.cbMuteMic=function(a,b){i.data.mutedMic=!i.data.mutedMic},b.confChangeVideoLayout=function(c,d){h.data.conf.setVideoLayout(c,d),b.videoLayout=c,a.$emit("changedVideoLayout",c)},b.confChangeSpeaker=function(b){i.data.selectedSpeaker=b,a.$emit("changedSpeaker",b)},b.confPopup=function(a){var b=(document.getElementById("webcam"),window.location.href),c=h.data.call.callID,d=h.data.call.params.remote_caller_id_number,e=webcam.offsetWidth,f=webcam.offsetHeight+100,g=(screen.width-e)/2,i=(screen.height-f)/2;b=b.replace(/\#.*/,""),b+="#/?sessid=random&master="+c+"&watcher=true&extension="+d+"&canvas_id="+a,console.log("opening new window to "+b),window.open(b,"canvas_window_"+a,"toolbar=0,location=0,menubar=0,directories=0,width="+e+",height="+f,NaN+g+",top="+i).moveTo(g,i)},b.screenshare=function(){if(h.data.shareCall)return h.screenshareHangup(),!1;h.data.conf?(console.log("Screenshare inside conferece: ",h.data.conf),h.screenshare(h.data.conf.params.laData.laName)):h.screenshare(i.data.called_number)},b.muteMic=h.muteMic,b.muteVideo=h.muteVideo,a.$on("ScreenShareExtensionStatus",function(a,b){switch(b){case"permission-denied":g.info("Please allow the plugin in order to use Screen Share","Error");break;case"not-installed":g.warning('Please <a target="_blank" class="install" href="https://chrome.google.com/webstore/detail/screen-capturing/ajhifddimkapgcifgcodmmfdlknahffk">install</a> the plugin in order to use Screen Share',"Warning",{allowHtml:!0});break;case"installed-disabled":g.info("Please enable the plugin in order to use Screen Share","Error")}}),f(function(){console.log("broadcast time-start incall"),b.$broadcast("timer-start")},1e3)}])}(),function(){"use strict";angular.module("vertoControllers").controller("LoginController",["$scope","$http","$location","verto",function(a,b,c,d){!function(){d.data.connected&&c.path("/dialpad")}();var e=c.search().name,f=c.search().email,g=c.search().skipPreview;if(e&&f)return d.data.name=e,d.data.email=f,void a.login(!0,g);d.data.name=a.storage.data.name,d.data.email=a.storage.data.email,console.debug("Executing LoginController.")}])}(),function(){"use strict";angular.module("vertoControllers").controller("MainController",["$scope","$rootScope","$location","$modal","$timeout","$q","verto","storage","CallHistory","toastr","Fullscreen","prompt","eventQueue","$translate","$window",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){function p(c,d){if(!b.ws_modalInstance){var e={backdrop:"static",keyboard:!1};a.showReconnectModal&&(b.ws_modalInstance=a.openModal("partials/ws_reconnect.html","ModalWsReconnectController",e))}}function q(a,c){h.data.autoBand&&g.testSpeed(),b.ws_modalInstance&&(b.ws_modalInstance.close(),b.ws_modalInstance=null)}function r(){gapi.client.plus.people.get({userId:"me"}).execute(s)}function s(b){for(var c,d=0;d<b.emails.length;d++)"account"===b.emails[d].type&&(c=b.emails[d].value);console.debug("Primary Email: "+c),console.debug("display name: "+b.displayName),console.debug("imageurl: "+b.image.url),console.debug(b),console.debug(g.data),g.data.email=c,g.data.name=b.displayName,h.data.name=g.data.name,h.data.email=g.data.email,a.login()}function t(a,b){a?j.info('Speaker is now <span class="install">'+b+"</a>","Success",{allowHtml:!0}):j.error("Your browser doesn't seem to support this feature","Error")}function u(c){var d=c.key;b.onKeydownDtmfEnabled&&d.match(/^(\*|\#|[0-9a-dA-D])$/g)&&(b.dtmfWidget(d),a.$applyAsync())}if(console.debug("Executing MainController."),b.dtmfHistory={value:""},b.onKeydownDtmfEnabled=!0,$.verto.haltClosure=function(){if("active"==g.data.callState)return!0},h.data.language&&"browser"!==h.data.language?n.use(h.data.language):h.data.language="browser",b.master=c.search().master,"true"===c.search().watcher){b.watcher=!0,angular.element(document.body).addClass("watcher");var v,w=v=c.search().extension,x=c.search().canvas_id;v&&(x&&(v+="-canvas-"+x),b.extension=w,b.canvasID=x,c.search().autocall=v)}var y=document.getElementById("webcam");a.verto=g,a.storage=h,a.call_history=angular.element("#call_history").hasClass("active"),b.chatStatus=angular.element("#wrapper").hasClass("toggled"),a.showReconnectModal=!0,b.chat_counter=0,b.activePane="members",b.dialpadNumber="",g.data.connected||(console.debug("MainController: WebSocket not connected. Redirecting to login."),c.path("/")),b.$on("config.http.success",function(b){a.login(!1)}),b.$on("changedSpeaker",function(a,b){g.data.call&&g.data.call.setAudioPlaybackDevice(b,t)}),b.login=function(b,d){void 0==b&&(b=!0),void 0==d&&(d=!1);var e=function(e,f){a.$apply(function(){g.data.connecting=!1,f&&(h.data.hostname=g.data.hostname,h.data.wsURL=g.data.wsURL,h.data.ui_connected=g.data.connected,h.data.ws_connected=g.data.connected,h.data.name=g.data.name,h.data.email=g.data.email,h.data.login=g.data.login,h.data.password=g.data.password,h.data.autoBand&&g.testSpeed(),b&&h.data.preview&&!d?c.path("/loading"):b&&c.path("/dialpad"))})};g.data.connecting=!0,g.connect(e)},b.logout=function(){var b=function(){var b=function(a,b){console.debug("Redirecting to login page."),h.reset(),"undefined"!=typeof gapi&&(console.debug(gapi),gapi.auth.signOut()),c.path("/login")};g.data.call&&g.hangup(),a.closeChat(),a.showReconnectModal=!1,g.disconnect(b),g.hangup()};g.data.call?l({title:n.instant("TITLE_ACTIVE_CALL"),message:n.instant("MESSAGE_ACTIVE_CALL_HANGUP")}).then(function(){b()}):b()},a.openModalSettings=function(){var b=d.open({animation:a.animationsEnabled,templateUrl:"partials/modal_settings.html",controller:"ModalSettingsController"});b.result.then(function(a){console.log(a)},function(){console.info("Modal dismissed at: "+new Date)}),b.rendered.then(function(){jQuery.material.init()})},b.openModal=function(b,c,e){var f={animation:a.animationsEnabled,templateUrl:b,controller:c};angular.extend(f,e);var g=d.open(f);return g.result.then(function(a){console.log(a)},function(){console.info("Modal dismissed at: "+new Date)}),g.rendered.then(function(){jQuery.material.init()}),g},b.$on("ws.close",p),b.$on("ws.login",q),b.ws_modalInstance,a.showAbout=function(){a.openModal("partials/about.html","AboutController")},a.showContributors=function(){a.openModal("partials/contributors.html","ContributorsController")},b.dtmf=function(a){console.log("dtmf",a),b.dialpadNumber=b.dialpadNumber+a,g.data.call&&g.dtmf(a)},b.backspace=function(){var a=b.dialpadNumber,c=a.length;b.dialpadNumber=a.substring(0,c-1)},a.toggleCallHistory=function(){a.call_history?(angular.element("#call_history").removeClass("active"),angular.element("#call-history-wrapper").removeClass("active")):(angular.element("#call_history").addClass("active"),angular.element("#call-history-wrapper").addClass("active")),a.call_history=angular.element("#call_history").hasClass("active")},a.toggleChat=function(){b.chatStatus&&"chat"===b.activePane&&(b.chat_counter=0),angular.element("#wrapper").toggleClass("toggled"),b.chatStatus=angular.element("#wrapper").hasClass("toggled"),updateVideoSize()},b.openChat=function(){b.chatStatus=!1,angular.element("#wrapper").removeClass("toggled")},a.closeChat=function(){b.chatStatus=!0,angular.element("#wrapper").addClass("toggled")},a.toggleSettings=function(){var a=angular.element(document.querySelector("#settings"));a.toggleClass("toggled"),b.$emit("toggledSettings",a.hasClass("toggled"))},a.closeSettings=function(){var a=angular.element(document.querySelector("#settings"));a.hasClass("toggled")&&(a.removeClass("toggled"),b.$emit("toggledSettings",a.hasClass("toggled")))},a.goFullscreen=function(){"connected"===h.data.userStatus&&(b.fullscreenEnabled=!k.isEnabled(),k.isEnabled()?k.cancel():k.enable(document.getElementsByTagName("body")[0]))},b.$on("call.video",function(a){h.data.videoCall=!0}),b.$on("call.hangup",function(a,d){k.isEnabled()&&k.cancel(),b.chatStatus||(angular.element("#wrapper").toggleClass("toggled"),b.chatStatus=angular.element("#wrapper").hasClass("toggled")),b.dialpadNumber="",console.debug("Redirecting to dialpad page."),c.path("/dialpad");try{b.$digest()}catch(a){console.log("not digest")}}),b.$on("page.incall",function(a,b){var d=function(){return f(function(a,b){h.data.askRecoverCall?l({title:n.instant("TITLE_ACTIVE_CALL"),message:n.instant("MESSAGE_ACTIVE_CALL_BACK")}).then(function(){console.log("redirect to incall page"),c.path("/incall")},function(){h.data.userStatus="connecting",g.hangup()}):(console.log("redirect to incall page"),c.path("/incall")),a()})};m.events.push(d)}),a.$on("event:google-plus-signin-success",function(a,b){console.log("Google+ Login Success"),console.log(b),gapi.client.load("plus","v1",r)}),a.$on("event:google-plus-signin-failure",function(a,b){console.log("Google+ Login Failure")}),b.callActive=function(d,f){g.data.mutedMic=h.data.mutedMic,g.data.mutedVideo=h.data.mutedVideo,h.data.cur_call||(h.data.call_start=new Date),h.data.userStatus="connected";var i=new Date(h.data.call_start);b.start_time=i,e(function(){a.$broadcast("timer-start")}),y.play(),h.data.calling=!1,h.data.cur_call=1,c.path("/incall"),f.useVideo&&b.$emit("call.video","video")},b.$on("call.active",function(a,c,d){b.callActive(c,d)}),b.$on("call.calling",function(a,b){h.data.calling=!0}),b.$on("call.incoming",function(d,e){console.log("Incoming call from: "+e),h.data.cur_call=0,a.incomingCall=!0,h.data.videoCall=!1,h.data.mutedVideo=!1,h.data.mutedMic=!1,l({title:n.instant("TITLE_INCOMING_CALL"),message:n.instant("MESSAGE_INCOMING_CALL")+e}).then(function(){var d=new Date(h.data.call_start);b.start_time=d,console.log(b.start_time),a.answerCall(),h.data.called_number=e,i.add(e,"inbound",!0),c.path("/incall")},function(){a.declineCall(),i.add(e,"inbound",!1)})}),a.hold=function(){h.data.onHold=!h.data.onHold,g.data.call.toggleHold()},a.hangup=function(){return g.data.call?b.watcher?void window.close():(g.data.shareCall&&g.screenshareHangup(),g.hangup(),b.$emit("hangupCall"),void c.path("/dialpad")):(j.warning(n.instant("MESSAGE_NO_HANGUP_CALL")),void c.path("/dialpad"))},a.answerCall=function(){h.data.onHold=!1,g.data.call.answer({useStereo:h.data.useStereo,useCamera:h.data.selectedVideo,useVideo:h.data.useVideo,useMic:h.data.useMic,callee_id_name:g.data.name,callee_id_number:g.data.login}),c.path("/incall")},a.declineCall=function(){a.hangup(),a.incomingCall=!1},a.play=function(){a.promptInput(n.instant("MESSAGE_ENTER_FILENAME"),"","File",function(a){g.data.conf.play(a),console.log("play file :",a)})},a.stop=function(){g.data.conf.stop()},a.record=function(){a.promptInput(n.instant("MESSAGE_ENTER_FILENAME"),"","File",function(a){g.data.conf.record(a),console.log("recording file :",a)})},a.stopRecord=function(){g.data.conf.stopRecord()},a.snapshot=function(){a.promptInput(n.instant("MESSAGE_ENTER_FILENAME"),"","File",function(a){g.data.conf.snapshot(a),console.log("snapshot file :",a)})},b.dtmfWidget=function(a){b.dtmfHistory.value=b.dtmfHistory.value+a,g.data.call&&g.dtmf(a)},b.disableOnKeydownDtmf=function(){b.onKeydownDtmfEnabled=!1},b.enableOnKeydownDtmf=function(){b.onKeydownDtmfEnabled=!0},b.$on("$routeChangeStart",function(a,c,d){"/incall"===c.$$route.originalPath?(b.dtmfHistory.value="",angular.element(o).bind("keydown",u)):angular.element(o).unbind("keydown",u)})}])}(),function(){"use strict";angular.module("vertoControllers").controller("MenuController",["$scope","$http","$location","verto","storage","$rootScope",function(a,b,c,d,e,f){console.debug("Executing MenuController."),a.storage=e,f.$on("testSpeed",function(b,c){var f=e.data.vidQual,g=4;a.bandDown=c.downKPS,a.bandUp=c.upKPS,c.downKPS<2e3&&g--,c.upKPS<2e3&&g--,a.iconClass="mdi-device-signal-wifi-4-bar green",g<4?a.iconClass="mdi-device-signal-wifi-3-bar yellow":g<2&&(a.iconClass="mdi-device-signal-wifi-1-bar red"),d.videoQuality.forEach(function(b){b.id==f&&(a.vidRes=b.label)}),a.$apply()})}])}(),function(){"use strict";angular.module("vertoControllers").controller("ModalDialpadController",["$scope","$modalInstance",function(a,b){a.ok=function(){b.close("Ok.")},a.cancel=function(){b.dismiss("cancel")}}])}(),function(){"use strict";function a(a,b,c,d){function e(){a.ws_modalInstance&&d.data.instance&&(d.data.instance.rpcClient.stopRetrying(),a.ws_modalInstance.close(),delete d.data.instance)}
console.debug("Executing ModalWsReconnectController"),b.closeReconnect=e}angular.module("vertoControllers").controller("ModalWsReconnectController",a),a.$inject=["$rootScope","$scope","storage","verto"]}(),function(){"use strict";angular.module("vertoControllers").controller("ModalLoginInformationController",["$scope","$http","$location","$modalInstance","verto","storage",function(a,b,c,d,e,f){console.debug("Executing ModalLoginInformationController."),a.verto=e,a.storage=f,a.ok=function(){d.close("Ok.")},a.cancel=function(){d.dismiss("cancel")},e.data.name=f.data.name,e.data.email=f.data.email}])}(),function(){"use strict";angular.module("vertoControllers").controller("SettingsController",["$scope","$http","$location","$rootScope","storage","verto","$translate","toastr","configLanguages",function(a,b,c,d,e,f,g,h,i){console.debug("Executing ModalSettingsController."),$.material.init(),a.speakerFeature=void 0!==document.getElementById("webcam").sinkId,a.storage=e,a.verto=f,a.mydata=angular.copy(e.data),a.languages=i.languages,a.languages.unshift({id:"browser",name:g.instant("BROWSER_LANGUAGE")}),a.mydata.language=e.data.language||"browser",d.$on("$translateChangeSuccess",function(){g("BROWSER_LANGUAGE").then(function(b){a.languages[0].name=b})}),d.$on("toggledSettings",function(b,c){c?a.mydata=angular.copy(e.data):a.ok()}),a.ok=function(){console.log("Camera Selected is",a.mydata.selectedVideo,a.verto.data.videoDevices),angular.forEach(f.data.videoDevices,function(b){console.log("checking video ",b),b.id==a.mydata.selectedVideo&&(a.mydata.selectedVideoName=b.label,console.log("Setting selectedVideoName to ",b.label))}),a.mydata.selectedSpeaker!=e.data.selectedSpeaker&&d.$emit("changedSpeaker",a.mydata.selectedSpeaker),e.changeData(a.mydata),f.data.instance.iceServers(e.data.useSTUN),e.data.autoBand&&a.testSpeed();var b={googEchoCancellation:void 0===e.data.googEchoCancellation||e.data.googEchoCancellation,googNoiseSuppression:void 0===e.data.googNoiseSuppression||e.data.googNoiseSuppression,googHighpassFilter:void 0===e.data.googHighpassFilter||e.data.googHighpassFilter,googAutoGainControl:void 0===e.data.googAutoGainControl||e.data.googAutoGainControl,googAutoGainControl2:void 0===e.data.googAutoGainControl||e.data.googAutoGainControl};f.data.instance.options.audioParams=b},a.changedLanguage=function(a){if("browser"===a){e.data.language="browser";var b=g.preferredLanguage();g.use(b).then(function(a){},function(a){g.use("en")})}else g.use(a),e.data.language=a},a.refreshDeviceList=function(){return f.refreshDevices()},a.showPreview=function(){if(angular.element(document.querySelector("#settings")).toggleClass("toggled"),!f.data.call)return void c.path("/preview");h.warning(g.instant("MESSAGE_DISPLAY_SETTINGS"))},a.testSpeed=function(){function b(b){a.mydata.vidQual=e.data.vidQual,a.speedMsg="Up: "+b.upKPS+" Down: "+b.downKPS,a.isTestingSpeed=!1,a.$apply()}return a.isTestingSpeed=!0,f.testSpeed(b)},a.resetSettings=function(){confirm("Factory Reset Settings?")&&(e.factoryReset(),a.logout(),window.location.reload())},a.checkAutoBand=function(b){a.mydata.useDedenc=!1;var c=videoQuality[videoQuality.length-1];a.mydata.vidQual=c.id,e.data.vidQual=c.id,f.data.instance.videoParams({minWidth:c.width,minHeight:c.height,maxWidth:c.width,maxHeight:c.height,minFrameRate:15,vertoBestFrameRate:e.data.bestFrameRate}),e.data.vidQual=c.id,b?a.mydata.testSpeedJoin=!0:(a.mydata.outgoingBandwidth="default",a.mydata.incomingBandwidth="default",a.mydata.testSpeedJoin=!1)},a.checkUseDedRemoteEncoder=function(b){-1!=["0","default","5120"].indexOf(b)?a.mydata.useDedenc=!1:a.mydata.useDedenc=!0},a.checkVideoQuality=function(a){var b=videoResolution[a].width,c=videoResolution[a].height;e.data.vidQual=a,f.data.instance.videoParams({minWidth:b,minHeight:c,maxWidth:b,maxHeight:c,minFrameRate:15,vertoBestFrameRate:e.data.bestFrameRate})}}])}(),function(){"use strict";angular.module("vertoControllers").controller("PreviewController",["$rootScope","$scope","$http","$location","$modal","$timeout","toastr","verto","storage","prompt","Fullscreen","$translate",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(a){if("function"==typeof a)a.stop();else if(a.active){var b=a.getTracks();b.forEach(function(a,b){a.stop()})}}function n(a){t&&m(t),t=a,FSRTCattachMediaStream(o,a),q&&(r=q.createMediaStreamSource(a),s=createAudioMeter(q),r.connect(s))}b.storage=i,console.debug("Executing PreviewController.");var o=document.getElementById("videopreview"),p=document.querySelector("#mic-meter .volumes");p&&(p=p.children),b.localVideo=function(){var a={mirrored:!0,audio:{optional:[{sourceId:i.data.selectedAudio}]}},b=h.data.videoDevices.find(function(a){return a.id==i.data.selectedVideo});i.data.selectedVideo=b.id,i.data.selectedVideoName=b.label,"none"!==b.id&&(a.video={optional:[{sourceId:b.id}]}),navigator.getUserMedia(a,n,function(a,b){})};var q=null;"undefined"!=typeof AudioContext&&(q=new AudioContext);var r=null,s=null,t={};b.refreshDeviceList=function(){return h.refreshDevices()},b.videoCall=function(){j({title:l.instant("TITLE_ENABLE_VIDEO"),message:l.instant("MESSAGE_ENABLE_VIDEO")}).then(function(){i.data.videoCall=!0,b.callTemplate="partials/video_call.html"})},b.cbMuteVideo=function(a,b){i.data.mutedVideo=!i.data.mutedVideo},b.cbMuteMic=function(a,b){i.data.mutedMic=!i.data.mutedMic},b.confChangeVideoLayout=function(a){h.data.conf.setVideoLayout(a)},b.endPreview=function(){o.src=null,q&&(s.shutdown(),s.onaudioprocess=null),m(t),d.path("/dialpad"),i.data.preview=!1},b.localVideo()}])}(),function(){"use strict";angular.module("vertoControllers").controller("LoadingController",["$rootScope","$scope","$location","$interval","verto",function(a,b,c,d,e){console.log("Loading controller");var f;b.stopInterval=function(){d.cancel(f)},f=d(function(){e.data.resCheckEnded&&(b.stopInterval(),c.path("/preview"))},1e3)}])}(),function(){"use strict";angular.module("vertoDirectives",[])}(),function(){"use strict";angular.module("vertoDirectives").directive("autofocus",["$timeout",function(a){return{restrict:"A",link:function(b,c){a(function(){c[0].focus()})}}}])}(),function(){"use strict";angular.module("vertoDirectives").directive("showControls",["Fullscreen",function(a){return{link:function(b,c,d){var e=null;jQuery(".video-footer").fadeIn("slow"),jQuery(".video-hover-buttons").fadeIn("slow"),c.parent().bind("mousemove",function(){a.isEnabled()&&(clearTimeout(e),jQuery(".video-footer").fadeIn("slow"),jQuery(".video-hover-buttons").fadeIn(500),e=setTimeout(function(){a.isEnabled()&&(jQuery(".video-footer").fadeOut("slow"),jQuery(".video-hover-buttons").fadeOut(500))},3e3))}),c.parent().bind("mouseleave",function(){jQuery(".video-footer").fadeIn(),jQuery(".video-hover-buttons").fadeIn()})}}}])}(),function(){"use strict";angular.module("vertoDirectives").directive("userStatus",function(){return{scope:{condition:"="},link:function(a,b,c){a.$watch("condition",function(a){b.removeClass("connected"),b.removeClass("disconnected"),b.removeClass("connecting"),b.addClass(a)})}}})}(),function(){"use strict";angular.module("vertoDirectives").directive("videoTag",function(){function a(a,b,c){console.log("Moving the video to element.");var d=jQuery("#webcam");document.getElementsByClassName("video-tag-wrapper")[0].appendChild(document.getElementById("webcam")),$("#webcam").resize(function(){updateVideoSize()}),$(window).resize(function(){updateVideoSize()}),updateVideoSize(),d.removeClass("hide"),d.css("display","block"),a.callActive("",{useVideo:!0}),b.on("$destroy",function(){console.log("Moving the video back to body."),d.addClass("hide").appendTo(jQuery("body")),$(window).unbind("resize")})}return{link:a}})}(),function(){"use strict";angular.module("vertoFilters",[])}(),function(){"use strict";angular.module("vertoFilters").filter("picturify",function(){var a=/<a (|target="\s*\S*" )href="(\s*\S*.(png|jpg|svg|gif|webp|bmp))">\s*\S*<\/a>/i,b=/data:image\/(\s*\S*);base64,((?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=))/g;return function(c,d,e){var f=0;d=d||150,b.test(c)&&(c=c.replace(b,'<a href="$1" target="_blank"><img class="chat-img" width="'+d+'" src="data:image/png;base64,$2"/></a>'));do{c=c.replace(a,'<a $1href="$2"><img class="chat-img" width="'+d+'" src="$2"/></a>')}while((!e||e&&f++<e)&&a.test(c));return c}})}(),function(){"use strict";angular.module("vertoService",[])}();var videoQuality=[],videoQualitySource=[{id:"qqvga",label:"QQVGA 160x120",width:160,height:120},{id:"qvga",label:"QVGA 320x240",width:320,height:240},{id:"vga",label:"VGA 640x480",width:640,height:480},{id:"qvga_wide",label:"QVGA WIDE 320x180",width:320,height:180},{id:"vga_wide",label:"VGA WIDE 640x360",width:640,height:360},{id:"hd",label:"HD 1280x720",width:1280,height:720},{id:"hhd",label:"HHD 1920x1080",width:1920,height:1080}],videoResolution={qqvga:{width:160,height:120},qvga:{width:320,height:240},vga:{width:640,height:480},qvga_wide:{width:320,height:180},vga_wide:{width:640,height:360},hd:{width:1280,height:720},hhd:{width:1920,height:1080}},bandwidth=[{id:"250",label:"250kb"},{id:"500",label:"500kb"},{id:"1024",label:"1mb"},{id:"1536",label:"1.5mb"},{id:"2048",label:"2mb"},{id:"3196",label:"3mb"},{id:"4192",label:"4mb"},{id:"5120",label:"5mb"},{id:"0",label:"No Limit"},{id:"default",label:"Server Default"}],framerate=[{id:"15",label:"15 FPS"},{id:"20",label:"20 FPS"},{id:"30",label:"30 FPS"}],updateReq,updateVideoSize=function(a){a||(a=500),clearTimeout(updateReq),updateReq=setTimeout(function(){var a=jQuery("#webcam");a.width(""),a.height("");var b,c,d=a.width(),e=a.height(),f=d/e,g=jQuery("div.video-wrapper");d>e?(b=g.width(),c=Math.round(g.width()/f)):(c=g.height(),b=Math.round(g.height()/f)),a.width(b),a.height(c),console.log("Setting video size to "+b+"/"+c)},a)},vertoService=angular.module("vertoService",["ngCookies"]);vertoService.service("verto",["$rootScope","$cookieStore","$location","storage",function(a,b,c,d){function e(a){k.shareCall=null,k.callState="active",a.refreshDevices()}function f(){k.call=null,k.callState=null,k.conf=null,k.confLayouts=[],k.confRole=null,k.chattingWith=null,a.$emit("call.hangup","hangup")}function g(b,c){a.$emit("call.active",b,c)}function h(){a.$emit("call.calling","calling")}function i(b){a.$emit("call.incoming",b)}function j(a){return console.debug("Attempting to sync supported and available resolutions"),console.debug("VQ length: "+videoQualitySource.length),console.debug(a),angular.forEach(videoQualitySource,function(b,c){angular.forEach(a,function(a){var c=a[0],d=a[1];b.width==c&&b.height==d&&videoQuality.push(b)})}),console.debug("VQ length 2: "+videoQuality.length),k.videoQuality=videoQuality,console.debug(videoQuality),k.vidQual=videoQuality.length>0?videoQuality[videoQuality.length-1].id:null,console.debug(k.vidQual),videoQuality}var k={instance:null,connected:!1,call:null,shareCall:null,callState:null,conf:null,confLayouts:[],confRole:null,chattingWith:null,liveArray:null,videoDevices:[],audioDevices:[],shareDevices:[],videoQuality:[],extension:b.get("verto_demo_ext"),name:b.get("verto_demo_name"),email:b.get("verto_demo_email"),cid:b.get("verto_demo_cid"),textTo:b.get("verto_demo_textto")||"1000",login:b.get("verto_demo_login")||"1008",password:b.get("verto_demo_passwd")||"1234",hostname:window.location.hostname,wsURL:"wss://"+window.location.hostname+":8082",wsFallbackURL:null,turnServer:null,resCheckEnded:!1};return{data:k,callState:{muteMic:!1,muteVideo:!1},videoQuality:videoQuality,videoResolution:videoResolution,bandwidth:bandwidth,framerate:framerate,refreshDevicesCallback:function(a){k.videoDevices=[{id:"none",label:"No Camera"}],k.shareDevices=[{id:"screen",label:"Screen"}],k.audioDevices=[{id:"any",label:"Default Microphone"},{id:"none",label:"No Microphone"}],k.speakerDevices=[{id:"any",label:"Default Speaker"}],d.data.selectedShare||(d.data.selectedShare=k.shareDevices[0].id);for(var b in jQuery.verto.videoDevices){var c=jQuery.verto.videoDevices[b];c.label?k.videoDevices.push({id:c.id,label:c.label||c.id}):k.videoDevices.push({id:"Camera "+b,label:"Camera "+b}),0!=b||d.data.selectedVideo||(d.data.selectedVideo=c.id),c.label?k.shareDevices.push({id:c.id,label:c.label||c.id}):k.shareDevices.push({id:"Share Device "+b,label:"Share Device "+b})}for(var b in jQuery.verto.audioInDevices){var c=jQuery.verto.audioInDevices[b];0!=b||d.data.selectedAudio||(d.data.selectedAudio=c.id),c.label?k.audioDevices.push({id:c.id,label:c.label||c.id}):k.audioDevices.push({id:"Microphone "+b,label:"Microphone "+b})}for(var b in jQuery.verto.audioOutDevices){var c=jQuery.verto.audioOutDevices[b];0!=b||d.data.selectedSpeaker||(d.data.selectedSpeaker=c.id),c.label?k.speakerDevices.push({id:c.id,label:c.label||c.id}):k.speakerDevices.push({id:"Speaker "+b,label:"Speaker "+b})}console.debug("Devices were refreshed, checking that we have cameras.");var e=k.videoDevices.some(function(a){return console.log("Evaluating device ",a),a.label==d.data.selectedVideoName?(console.log("Matched video selection by name: ",a.label),d.data.selectedVideo=a.id,!0):a.id==d.data.selectedVideo&&"none"!==d.data.selectedVideo}),f=k.shareDevices.some(function(a){return a.id==d.data.selectedShare}),g=k.audioDevices.some(function(a){return a.id==d.data.selectedAudio}),h=k.speakerDevices.some(function(a){return a.id==d.data.selectedSpeaker});console.log("Storage Video: ",d.data.selectedVideo),console.log("Video Flag: ",e),e||(d.data.selectedVideo=k.videoDevices[k.videoDevices.length-1].id),f||(d.data.selectedShare=k.shareDevices[0].id),g||(d.data.selectedAudio=k.audioDevices[0].id),!h&&k.speakerDevices.length>0&&(d.data.selectedSpeaker=k.speakerDevices[0].id),0===k.videoDevices.length?(console.log("No camera, disabling video."),k.canVideo=!1,k.videoDevices.push({id:"none",label:"No camera"})):k.canVideo=!0,angular.isFunction(a)&&a()},refreshDevices:function(a){console.debug("Attempting to refresh the devices."),a?jQuery.verto.refreshDevices(a):jQuery.verto.refreshDevices(this.refreshDevicesCallback)},refreshVideoResolution:function(a){if(console.debug("Attempting to refresh video resolutions."),k.instance){var b=a.bestResSupported[0],c=a.bestResSupported[1];1080===c&&(b=1280,c=720),j(a.validRes),!d.data.autoBand&&d.data.vidQual&&(b=videoResolution[d.data.vidQual].width,c=videoResolution[d.data.vidQual].height),k.instance.videoParams({minWidth:b,minHeight:c,maxWidth:b,maxHeight:c,minFrameRate:15,vertoBestFrameRate:d.data.bestFrameRate}),videoQuality.forEach(function(a){b===a.width&&c===a.height&&(d.data.vidQual===a.id&&void 0!==d.data.vidQual||(d.data.vidQual=a.id))}),k.resCheckEnded=!0}else console.debug("There is no instance of verto.")},connect:function(b){function j(b,c,e){a.$emit("call.video","video"),a.$emit("call.conference","conference"),k.chattingWith=e.chatID,k.confRole=e.role,k.conferenceMemberID=e.conferenceMemberID;var f=new $.verto.conf(b,{dialog:c,hasVid:d.data.useVideo,laData:e,chatCallback:function(b,c){var d=c.data.fromDisplay||c.data.from||"Unknown",e=c.data.message||"";a.$emit("chat.newMessage",{from:d,body:e})},onBroadcast:function(b,c,d){if(console.log(">>> conf.onBroadcast:",arguments),"response"==d.action)if("list-videoLayouts"==d["conf-command"]){var e=[];for(var f in d.responseData)e.push(d.responseData[f].name);var g=e.sort(function(a,b){var c="group:"==a.substring(0,6),d="group:"==b.substring(0,6);return(c||d)&&c!=d?c?-1:1:a==b?0:a>b?1:-1});k.confLayoutsData=d.responseData,k.confLayouts=g}else"canvasInfo"==d["conf-command"]?(k.canvasInfo=d.responseData,a.$emit("conference.canvasInfo",d.responseData)):a.$emit("conference.broadcast",d)}});"moderator"==k.confRole&&(console.log(">>> conf.listVideoLayouts();"),f.listVideoLayouts(),f.modCommand("canvasInfo")),k.conf=f,k.liveArray=new $.verto.liveArray(k.instance,e.laChannel,e.laName,{subParams:{callID:c?c.callID:null}}),k.liveArray.onErr=function(a,b){console.log("liveArray.onErr",a,b)},k.liveArray.onChange=function(b,c){switch(c.action){case"bootObj":a.$emit("members.boot",c.data),c.data.forEach(function(b){var c=b[0],d=angular.fromJson(b[1][4]);c===k.call.callID&&a.$apply(function(){k.mutedMic=d.audio.muted,k.mutedVideo=d.video.muted})});break;case"add":var d=[c.key,c.data];a.$emit("members.add",d);break;case"del":var e=c.key;a.$emit("members.del",e);break;case"clear":a.$emit("members.clear");break;case"modify":var d=[c.key,c.data];a.$emit("members.update",d);break;default:console.log("NotImplemented",c.action)}}}function l(){console.log("stopConference()"),k.liveArray?(k.liveArray.destroy(),console.log("Has data.liveArray."),a.$emit("members.clear"),k.liveArray=null):console.log("Doesn't found data.liveArray."),k.conf&&(k.conf.destroy(),k.conf=null)}function m(){var a=c.search().sessid;if("random"===a&&(a=$.verto.genUUID(),c.search().sessid=a),k.instance&&!k.instance.rpcClient.socketReady())return k.instance.rpcClient.stopRetrying(),k.instance.logout(),void k.instance.login();k.instance=new jQuery.verto({login:k.login+"@"+k.hostname,passwd:k.password,socketUrl:k.wsURL,wsFallbackURL:k.wsFallbackURL,turnServer:k.turnServer,tag:"webcam",ringFile:"sounds/bell_ring2.wav",audioParams:{googEchoCancellation:void 0===d.data.googEchoCancellation||d.data.googEchoCancellation,googNoiseSuppression:void 0===d.data.googNoiseSuppression||d.data.googNoiseSuppression,googHighpassFilter:void 0===d.data.googHighpassFilter||d.data.googHighpassFilter,googAutoGainControl:void 0===d.data.googAutoGainControl||d.data.googAutoGainControl,googAutoGainControl2:void 0===d.data.googAutoGainControl||d.data.googAutoGainControl},sessid:a,iceServers:d.data.useSTUN},o),n.reloaded=!1,jQuery.verto.unloadJobs.push(function(){n.reloaded=!0}),k.instance.deviceParams({useCamera:d.data.selectedVideo,useSpeak:d.data.selectedSpeaker,useMic:d.data.selectedAudio,onResCheck:n.refreshVideoResolution})}console.debug("Attempting to connect to verto.");var n=this,o={onWSLogin:function(c,d){k.connected=d,a.loginFailed=!d,a.$emit("ws.login",d),console.debug("Connected to verto server:",d),angular.isFunction(b)&&b(c,d)},onMessage:function(b,c,d,e){switch(console.debug("onMessage:",b,c,d,e),d){case $.verto.enum.message.pvtEvent:if(e.pvtData)switch(e.pvtData.action){case"conference-liveArray-join":e.pvtData.screenShare||e.pvtData.videoOnly||(console.log("conference-liveArray-join"),l(),j(b,c,e.pvtData),updateVideoSize());break;case"conference-liveArray-part":e.pvtData.screenShare||e.pvtData.videoOnly||(console.log("conference-liveArray-part"),l())}break;case $.verto.enum.message.info:var f=e.body,g=e.from_msg_name||e.from;if(!f)return void console.log("Received an empty body: ",e);a.$emit("chat.newMessage",{from:g,body:f});break;case $.verto.enum.message.display:a.$apply(function(){});break;case $.verto.enum.message.clientReady:a.$emit("clientReady",{reattached_sessions:e.reattached_sessions});break;default:console.warn("Got a not implemented message:",d,c,e)}},onDialogState:function(a){switch(k.call||(k.call=a),console.debug("onDialogState:",a),a.state.name){case"ringing":i(a.params.caller_id_number);break;case"trying":console.debug("Calling:",a.cidString()),k.callState="trying";break;case"early":console.debug("Talking to:",a.cidString()),k.callState="active",h();break;case"active":console.debug("Talking to:",a.cidString()),k.callState="active",g(a.lastState.name,a.params),updateVideoSize();break;case"hangup":console.debug("Call ended with cause: "+a.cause),k.callState="hangup";break;case"destroy":console.debug("Destroying: "+a.cause),a.params.screenShare?e(n):(l(),n.reloaded||f());break;default:console.warn("Got a not implemented state:",a)}},onWSClose:function(b,c){console.debug("onWSClose:",c),a.$emit("ws.close",c)},onEvent:function(a,b){console.debug("onEvent:",b)}},n=this;k.mediaPerm?m():$.FSRTC.checkPerms(m,!0,!0)},mediaPerm:function(a){$.FSRTC.checkPerms(a,!0,!0)},login:function(a){k.instance.loginData({login:k.login+"@"+k.hostname,passwd:k.password}),k.instance.login(),angular.isFunction(a)&&a(k.instance,!0)},disconnect:function(a){console.debug("Attempting to disconnect to verto."),k.instance.logout(),k.connected=!1,console.debug("Disconnected from verto server."),angular.isFunction(a)&&a(k.instance,k.connected)},call:function(a,b,c){console.debug("Attempting to call destination "+a+".");var e=k.instance.newCall(angular.extend({destination_number:a,caller_id_name:k.name,caller_id_number:k.callerid?k.callerid:k.email,outgoingBandwidth:d.data.outgoingBandwidth,incomingBandwidth:d.data.incomingBandwidth,useVideo:d.data.useVideo,useStereo:d.data.useStereo,useCamera:d.data.selectedVideo,useSpeak:d.data.selectedSpeaker,useMic:d.data.selectedAudio,dedEnc:d.data.useDedenc,mirrorInput:d.data.mirrorInput,userVariables:{email:d.data.email,avatar:"http://gravatar.com/avatar/"+md5(d.data.email)+".png?s=600"}},c));k.call=e,k.mutedMic=!1,k.mutedVideo=!1,angular.isFunction(b)&&b(k.instance,e)},screenshare:function(b,c){var e=this;if("screen"!==d.data.selectedShare){console.log("share screen from device "+d.data.selectedShare);var f=k.instance.newCall({destination_number:b+"-screen",caller_id_name:k.name+" (Screen)",caller_id_number:k.login+" (screen)",outgoingBandwidth:d.data.outgoingBandwidth,incomingBandwidth:d.data.incomingBandwidth,useCamera:d.data.selectedShare,useVideo:!0,screenShare:!0,dedEnc:d.data.useDedenc,mirrorInput:d.data.mirrorInput,userVariables:{email:d.data.email,avatar:"http://gravatar.com/avatar/"+md5(d.data.email)+".png?s=600"}});return f.rtc.options.callbacks.onStream=function(a,b){function c(){e.data.shareCall&&(e.screenshareHangup(),console.log("screenshare ended"))}b&&b.getVideoTracks()[0].addEventListener("ended",c),console.log("screenshare started")},k.shareCall=f,console.log("shareCall",k),k.mutedMic=!1,k.mutedVideo=!1,void e.refreshDevices()}console.log("share screen from plugin "+d.data.selectedShare);var g=function(c,f,g){if(c)return void a.$emit("ScreenShareExtensionStatus",c);var h=k.instance.newCall({destination_number:b+"-screen",caller_id_name:k.name+" (Screen)",caller_id_number:k.login+" (Screen)",outgoingBandwidth:d.data.outgoingBandwidth,incomingBandwidth:d.data.incomingBandwidth,videoParams:g?g.video.mandatory:{},useVideo:!0,screenShare:!0,dedEnc:d.data.useDedenc,mirrorInput:d.data.mirrorInput,userVariables:{email:d.data.email,avatar:"http://gravatar.com/avatar/"+md5(d.data.email)+".png?s=600"}});h.rtc.options.callbacks.onStream=function(a,b){function c(){e.data.shareCall&&(e.screenshareHangup(),console.log("screenshare ended"))}b&&b.getVideoTracks()[0].addEventListener("ended",c),console.log("screenshare started")},k.shareCall=h,console.log("shareCall",k),k.mutedMic=!1,k.mutedVideo=!1};navigator.mozGetUserMedia?g():getScreenId(g)},screenshareHangup:function(){if(!k.shareCall)return console.debug("There is no call to hangup."),!1;console.log("shareCall End",k.shareCall),k.shareCall.hangup(),console.debug("The screencall was hangup.")},hangup:function(a){if(console.debug("Attempting to hangup the current call."),!k.call)return console.debug("There is no call to hangup."),!1;k.call.hangup(),k.conf&&(k.conf.destroy(),k.conf=null),console.debug("The call was hangup."),angular.isFunction(a)&&a(k.instance,!0)},dtmf:function(a,b){if(console.debug('Attempting to send DTMF "'+a+'".'),!k.call)return console.debug("There is no call to send DTMF."),!1;k.call.dtmf(a.toString()),console.debug("The DTMF was sent for the call."),angular.isFunction(b)&&b(k.instance,!0)},testSpeed:function(b){k.instance.rpcClient.speedTest(262144,function(c,e){var f=Math.ceil(.75*e.upKPS),g=Math.ceil(.75*e.downKPS);d.data.autoBand&&(d.data.incomingBandwidth=g,d.data.outgoingBandwidth=f,d.data.useDedenc=!1,d.data.vidQual="hd",f<256?d.data.vidQual="qqvga":f<512?d.data.vidQual="qvga":f<1024&&(d.data.vidQual="vga")),b&&b(e),a.$emit("testSpeed",e)})},muteMic:function(a){if(console.debug("Attempting to mute mic for the current call."),!k.call)return console.debug("There is no call to mute."),!1;k.call.dtmf("0"),k.mutedMic=!k.mutedMic,console.debug("The mic was muted for the call."),angular.isFunction(a)&&a(k.instance,!0)},muteVideo:function(a){if(console.debug("Attempting to mute video for the current call."),!k.call)return console.debug("There is no call to mute."),!1;k.call.dtmf("*0"),k.mutedVideo=!k.mutedVideo,console.debug("The video was muted for the call."),angular.isFunction(a)&&a(k.instance,!0)},sendConferenceChat:function(a){k.conf.sendChat(a,"message")},setCanvasIn:function(a,b){k.conf.modCommand("vid-canvas",a,b)},setCanvasOut:function(a,b){k.conf.modCommand("vid-watching-canvas",a,b)},setLayer:function(a,b){k.conf.modCommand("vid-layer",a,b)},setResevartionId:function(a,b){k.conf.modCommand("vid-res-id",a,b)},sendMessage:function(a,b){k.call.message({to:k.chattingWith,body:a,from_msg_name:k.name,from_msg_number:k.cid}),angular.isFunction(b)&&b(k.instance,!0)}}}]);var vertoService=angular.module("vertoService");vertoService.service("config",["$rootScope","$http","$location","storage","verto",function(a,b,c,d,e){return{configure:function(){d.data.name&&(e.data.name=d.data.name),d.data.email&&(e.data.email=d.data.email),d.data.login&&(e.data.login=d.data.login),d.data.password&&(e.data.password=d.data.password);var c=window.location.origin+window.location.pathname;return b.get(c+"config.json?cachebuster="+Math.floor(1e6*Math.random()+1)).then(function(b){var c=b.data,f=e.data.name,g=e.data.email;return console.debug("googlelogin: "+c.googlelogin),c.googlelogin&&(e.data.googlelogin=c.googlelogin,e.data.googleclientid=c.googleclientid),c.wsFallbackURL&&(e.data.wsFallbackURL=c.wsFallbackURL),c.turnServer&&(e.data.turnServer=c.turnServer),angular.extend(e.data,c),""!=f&&""==c.name&&(e.data.name=f),""!=g&&""==c.email&&(e.data.email=g),""==e.data.login&&""==e.data.password&&""!=d.data.login&&""!=d.data.password&&(e.data.login=d.data.login,e.data.password=d.data.password),"true"!=e.data.autologin||e.data.autologin_done||(console.debug("auto login per config.json"),e.data.autologin_done=!0),e.data.autologin&&d.data.name.length&&d.data.email.length&&d.data.login.length&&d.data.password.length&&a.$emit("config.http.success",c),b},function(b){return a.$emit("config.http.error",b),b})}}}]),angular.module("vertoService").service("eventQueue",["$rootScope","$q","storage","verto",function(a,b,c,d){var e=[],f=function(){var b,c;if(void 0==(b=e.shift()))return void a.$emit("eventqueue.complete");c=b();var d=function(){a.$emit("eventqueue.next")};c.then(function(){d()},function(){d()})};return{next:f,process:function(){a.$on("eventqueue.next",function(a){f()}),f()},events:e}}]),function(){"use strict";angular.module("storageService",["ngStorage"])}(),angular.module("storageService").service("storage",["$rootScope","$localStorage",function(a,b){function c(a){jQuery.extend(!0,d,a)}var d=b,e={ui_connected:!1,ws_connected:!1,cur_call:0,called_number:"",useVideo:!0,call_history:{},history_control:[],call_start:!1,name:"",email:"",login:"",password:"",userStatus:"disconnected",mutedVideo:!1,mutedMic:!1,preview:!0,selectedVideo:null,selectedVideoName:null,selectedAudio:null,selectedShare:null,selectedSpeaker:null,useStereo:!0,useSTUN:!0,useDedenc:!1,mirrorInput:!1,outgoingBandwidth:"default",incomingBandwidth:"default",vidQual:void 0,askRecoverCall:!1,googNoiseSuppression:!0,googHighpassFilter:!0,googEchoCancellation:!0,googAutoGainControl:!0,autoBand:!0,testSpeedJoin:!0,bestFrameRate:"15",language:void 0};return d.$default(e),{data:d,changeData:c,reset:function(){d.ui_connected=!1,d.ws_connected=!1,d.cur_call=0,d.userStatus="disconnected"},factoryReset:function(){localStorage.clear(),d.$reset(e)}}}]),angular.module("storageService").factory("CallHistory",["storage",function(a){var b=a.data.call_history,c=a.data.history_control,d=function(a,d,e){void 0==b[a]&&(b[a]=[]),b[a].unshift({number:a,direction:d,status:e,call_start:Date()});var f=c.indexOf(a);console.log(f),f>-1&&c.splice(f,1),c.unshift(a)},e=function(a){return b[a]};return{all:function(){return b},all_control:function(){return c},get:function(a){return e(a)},add:function(a,b,c){return d(a,b,c)},clear:function(){return a.data.call_history={},a.data.history_control=[],b=a.data.call_history,c=a.data.history_control}}}]),angular.module("storageService").service("splashscreen",["$rootScope","$q","storage","config","verto","$translate",function(a,b,c,d,e,f){var g=function(){return b(function(a,b){var c="browser-upgrade",d={activity:c,soft:!1,status:"success",message:f.instant("BROWSER_COMPATIBILITY")};navigator.mediaDevices.getUserMedia||(d.status="error",d.message=f.instant("BROWSER_WITHOUT_WEBRTC"),b(d)),a(d)})},h=function(){return b(function(a,b){var c="media-perm",d={activity:c,soft:!1,status:"success",message:f.instant("CHECK_PERMISSION_MEDIA")};e.mediaPerm(function(c){c||(d.status="error",d.message=f.instant("ERROR_PERMISSION_MEDIA"),e.data.mediaPerm=!1,b(d)),e.data.mediaPerm=!0,a(d)})})},i=function(){return b(function(a,b){var c="refresh-devices",d={status:"success",soft:!0,activity:c,message:f.instant("REFRESH_MEDIA_DEVICES")};e.refreshDevices(function(b){e.refreshDevicesCallback(function(){a(d)})})})},j=function(){return b(function(a,b){function d(b){a(h)}var g="check-connection-speed",h={status:"success",soft:!0,activity:g,message:f.instant("CHECK_CONNECTION_SPEED")};c.data.autoBand&&e.data.instance?e.testSpeed(d):a(h)})},k=function(){return b(function(a,b){var c="provision-config",e={status:"promise",soft:!0,activity:c,message:f.instant("CHECK_PROVISIONING_CONF")},g=d.configure(),h=g.then(function(a){return a.status>=200&&a.status<=299?e:(e.status="error",e.message=f.instant("ERROR_PROVISIONING_CONF"),e)});e.promise=h,a(e)})},l=function(){return b(function(a,b){var d="check-login",g={status:"success",soft:!0,activity:d,message:f.instant("CHECK_LOGIN")};if(e.data.connecting||e.data.connected)return void a(g);var h=function(){c.data.ui_connected&&c.data.ws_connected&&!e.data.connecting&&(e.data.hostname=c.data.hostname||e.data.hostname,e.data.wsURL=c.data.wsURL||e.data.wsURL,e.data.name=c.data.name,e.data.email=c.data.email,e.data.login=c.data.login,e.data.password=c.data.password,e.data.connecting=!0,e.connect(function(b,c){e.data.connecting=!1,a(g)}))};c.data.ui_connected&&c.data.ws_connected?h():a(g)})},m=[g,h,i,k,l,j],n=[f.instant("BROWSER_COMPATIBILITY"),f.instant("CHECK_PERMISSION_MEDIA"),f.instant("REFRESH_MEDIA_DEVICES"),f.instant("CHECK_PROVISIONING_CONF"),f.instant("CHECK_LOGIN"),f.instant("CHECK_CONNECTION_SPEED")],o=function(a){return void 0!=n[a]?n[a]:f.instant("PLEASE_WAIT")},p=-1,q=0,r=function(a){var b;return b=a+1,q=b/m.length*100};return{next:function(){var b,c,d,e,f,g,h,i;if(e=!1,++p>=m.length)return void a.$emit("progress.complete",p);b=m[p],c=b();var j=function(b){void 0!=b.promise&&(i=b.promise),d=b.status,g=b.soft,f=b.activity,h=b.message,"success"!=d&&(e=!0),a.$emit("progress.next",p,d,i,f,g,e,h)};c.then(function(a){j(a)},function(a){j(a)})},getProgressMessage:o,progress_percentage:q,calculate:r}}]);
//# sourceMappingURL=scripts.1f82e383.js.map